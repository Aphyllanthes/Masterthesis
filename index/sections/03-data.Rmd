
```{r include = FALSE}
knitr::opts_chunk$set(echo = FALSE, cache = TRUE)
options(scipen=999)
```


# Ergebnisse
In den Nisthilfen des Schulinsektenhaus-Projektes welche im Jahr 2019 ausgehängt waren wurden 4716 Bienennester sowie 2147 Wespennester aufgefunden. Somit machen die in dieser Arbeit behandelten Nester etwa 70 % der vorgefundenen Nester aus. Die Wespennester werden in dieser Arbeit nicht behandelt.
Alle weiteren Ergebnisse beziehen sich ausschließlich auf die Biennennester. In Abbildung \ref{deskriptiv} sind die Histogramme der Artenanzahl und Abundanz dargestellt.

```{r message=FALSE, warning=FALSE, include=FALSE, cache=TRUE}
#source("datenschau.R")
load("../my_work_space.RData")
```


<!-- Anzahl der Arten pro Nisthilfe | -->
<!-- Anzahl Brutzellen pro Nisthilfe | -->
<!-- | Überlebensrate | Anzahl der lebenden Puppen dividiert durch die Gesamtanzahl der Zellen | -->
<!-- | Parasitierungsrate | Anzahl der parasitierten Zellen dividiert durch die Gesamtanzahl der Zellen | -->

```{r datendeskriptiv, echo=FALSE, fig.cap="Histogramme der Anzahl der Wirts-Bienenarten pro Nisthilfe (links) und Anzahl der von Bienen angelegten Brutzellen (=Abundanz) pro Nisthilfe (rechts) \\label{deskriptiv}"}
p1 <- ggplot(A1, aes(Artenanzahl_det)) + geom_histogram(bins = 8) +
  theme_bw() + labs(x = "Artenzahl der Wirte")
p2 <- ggplot(A1, aes(Abundanz)) + geom_histogram(breaks=c(seq(0, 14, by = 1),seq(15, 100, by = 5), seq(110, 240, by = 10), seq(250, 850, by = 20))) + theme_bw() 

gridExtra::grid.arrange(p1, p2, ncol = 2, heights = unit(4, c("in")))

# sum(nests$nb_cells, na.rm = T) # Anzahl der Zellen gesamt: 18757
# sum(nests$nb_pupa_larva, na.rm = T) # Anzahl Puppen/Larven: 11376
# sum(nests$nb_pupa_larva, na.rm = T) / sum(nests$nb_cells, na.rm = T)
# sum(nests$parasitized_cells, na.rm = T) # Anzahl Parasitierter Zellen
# sum(nests$parasitized_cells, na.rm = T) / sum(nests$nb_cells, na.rm = T)
```


Von den insgesamt `r round(sum(nests$nb_cells, na.rm = T),0)` angelegten Zellen entwickelten sich in etwa 60 % (`r round(sum(nests$nb_pupa_larva, na.rm = T),0)` Brutzellen) Puppen bzw. Larven. Etwa 13 % der Angelegten Zellen wurde Parasitiert (`r sum(nests$parasitized_cells, na.rm = T)` Brutzellen).  

In 45 der 259 Nisthilfen kamen keine Bienen vor. Die häufigsten Wirtsbienenarten waren *Osmia bicornis*, welche 46 % der Nester belegten und *Heriades truncorum*, welche 16 % der Nester belegten. *Osmia cornuta* und *Hylaeus communis* belegten jeweils etwa 8 % der Nester, alle weiteren Arten belegten jeweils weniger als 5 % der Nester.
Der häufigste natürliche Gegenspieler war die Taufliege *Cacoxenus indagator*, welche 17 % aller Nester parasitierte. Arten der Überfamilie der Erzwespen (Chalcidoidea) parasitierten 150 Nester, also 3 % aller Nester, wobei vermutlich die Art *Melittobia acasta* den Großteil davon ausmachte. Die Kuckuckswespe *Sapygina decemguttata* kam mit einer Parasitierungsrate von knapp unter 3 % vor. Alle weiteren natürlichen Gegenspieler kamen je nur in weniger als 100 Nestern und somit in unter 2% aller Nester vor.

## Die Arten in den Nisthilfen
Im Rahmen des Schulinsektenhaus-Projektes konnten in den 259 Nisthilfen insgesammt 27 Wirts-Bienenarten sowie als Parasitoide fünf Kuckucksbienenarten (*Stelis* und *Coelioxys*) und neun parasitische Wespenarten (Apocrita) nachgewiesen werden. Weitere Gegenspieler wie verschiedene Diptera, Käfer (Coleoptera), Milben (*Chaetodacylus*) und Eulophidae kamen vor, wurden jedoch nicht genauer bestimmt. In Tabelle \ref{Artenliste} sind alle nachgewiesenen Arten sowie ihre Gegenspieler aufgeführt. Da einige Parasitoide das gesamte Nest ihres Wirtes eingenommen haben konnten die Wirtsarten nur anhand der Nestmorphologie bestimmt werden - diese sind in der dritten Spalte der Tabelle aufgeführt.

Im Vergleich zu @tscharntke1998 wurden sieben weitere Arten identifiziert: 

  - *Anthidium manicatum*
  - *Hylaeus graciliformis*, *H. hyalinatus*, *H. leptocephalus*, *H. taeniolatus*
  - *Megachile centuncularis*, *M. ligniseca* 
  
Dagegen führen @tscharntke1998 in ihrer Arbeit zwölf Arten auf, die in dieser Arbeit nicht identifiziert wurden:
 
 - *Chelostoma campanularum*, *C. distinctum*
 - *Hylaeus annularis*, *H. gibbus*, *H. punctualissimus*, *H. signatus*
 - *Megachile alpicola*, *M. versicolor*
 - *Osmia claviventris*, *O. gallarum*, *O. leucomelana*, *O. parietina*
 
Ein weiterer Parasit der in den Nestern dieser Arbeit vorkam, sind Milben der Gattung *Chaetodactylus*. Diese sind in der Tabelle \ref{Artenliste} nicht aufgeführt, da sie während der Lagerung in der Uni Freiburg in weitere Nester "übergelaufen" sind. Daher und durch zu späte Kenntnissnahme der bearbeitenden Personen wurden wahrscheinlich viele befallene Nester nicht als solche identifiziert. Es wurden ca. 100 Nester als von Chaetodactylus befallen identifiziert. Es kann aber davon ausgegangen werden, dass etwa das dreifache an Nestern befallen war. Leider konnten so aus sehr vielen Nestern keine Arten bestimmt werden - besonders groß war der Anteil an Nestern der Gattung *Megachile*. Identifiziert werden konnten dennoch folgende von Chaetodactylus befallene Arten:

  - *Anthidium nanum*
  - *Chelostoma florisomne*, *C. rapunculi* 
  - *Heriades crenulatus*, *H. truncorum* 
  - *Hylaeus communis*, *H. difformis*
  - *Megachile ericetorum*, *M. centuncularis*, *M. rotundata*
  - *Osmia adunca*, *O. bicornis*, *O. caerulescens*, *O. leaiana*
 
<!-- Welche Parasiten bei tscharntke vorkamen und bei uns nicht: Stelis punctulatissima bei Anthidium nanum, ... -->

 
```{r Artenliste, echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
Artliste_IH19 <- readxl::read_excel("../../Daten/Artliste_IH19.xls") %>% 
  replace(is.na(.), "")

kableExtra::kbl(Artliste_IH19,longtable =T,booktabs =T, caption = "Liste aller nachgewiesenen Bienenarten und ihere Parasitoide im Schulinsektenhausprojekt 2019. Alle Arten die in der Arbeit von Tscharntke et al. (1998) nicht beschrieben wurden bzw. bei den Gegenspielern nicht bei dem entsprechenden Wirt beschrieben wurden, sind mit einem '*' versehen.  \\label{Artenliste} ") %>% 
  kableExtra::kable_paper(full_width = F) %>%
  kableExtra::kable_styling(latex_options =c("repeat_header")) %>% 
  kableExtra::column_spec(1) %>%
  kableExtra::column_spec(2, width = "15em") %>%
  kableExtra::column_spec(3, width = "15em")
```



<!-- - chrysura radians an osmia adunca : zetero Galanthea (ohne id) -->

<!-- - ephialtes: @horstmann -->

## Der Einfluss der Landschaftstruktur 
Zwischen den Parametern der Landschaftstruktur, Kantenlänge und Anzahl der Landnutzungsklassen, und allen Modellierten Antwortvariablen konnte kein Zusammenhang aufgezeigt werden. 


<!-- Zwischen den Sturkturreichtum bescheibenden Parametern Kantendichte und Anzahl der Landnutzungsklassen und der Abundanz der Bienen kann kein Zusammenhang aufgezeigt werden. Ebenso wird kein Zusammenhang der den Strukturreichtum beschreibenden Parametern und der Artenzahl der Bienen beschrieben.  -->


## Der Einfluss von vorhandenen Insektenhäusern auf Artenzahl und Abundanz der Wildbienen
Die Artenzahl in den Nisthilfen in der Nähe eines Insektenhauses ist  höher als in Nisthilfen in deren Umfeld kein Insektenhaus vokommt. Der Effekt, im Modell welches den Einfluss von vorhandenen Insektenhäusern auf die Artenzahl der Wildbienen beschreibt, ist schwach signifikant.  
Dieses Modell kann durch die Erweiterung um die Prädiktoren des mittleren Versiegelungsgrades als linearer sowie quadratischer Term nicht verbessert werden. Dies gilt für alle Radien, für den der mittlere Versiegelungsgrad berechnet wurde. Der AIC dieser Modelle im Vergleich zum einfacheren Modell ohne den Versiegelungsgrad als Prädiktor ist jeweils nicht mehr als 2 Einheiten unterschiedlich.    
Umgekehrt verbessert der Parameter "Insektenhaus" das Modell mit den Prädiktoren "Versiegelungsgrad" und "Versiegelungsgrad im Quadrat" ebensowenig.  
In Tabelle \ref{summaryIH} ist der Einfluss den vorhandenen Insektenhäusern auf die Artenzahl abgebildet. Das Modell erklärt nur $2.9 \%$ der Varianz der Artenzahl.   
<!-- with(summary(modelIH), (null.deviance-deviance)/null.deviance) -->

Der Einfluss von vorhandenen Insektenhäusern auf die Abundanz der Wildbienen zeigt im Modell mit den zusätzlichen Prädiktoren des mittleren Versiegelungsgrades im 250m-Radius als linearen und quadratischen Term keinen signifikanten Zusammenhang (siehe Tab. \ref{summaryIH}). Die Erweiterung des Modells um den Versiegelungsgrad im 250m-Radius der einzige Radius des Versiegelungsgrades (aus den berechneten Radien von 100m,250m,500m,1000m,2000m), welcher das Modell der vorhandenen Insektenhäusern verbessert. Andersherum kann durch den Parameter "Insektenhaus" kein Modell mit dem Prädiktor Versiegelungsgrad verbessert werden.  
Ein Effekt-Plot des um den Parameter des 250m-Versiegelungsgrades erweiterten Modells ist in Abbilung \ref{effektplotIH} auf der rechten Seite dargestellt. Das Modells zeigt einen negativen signifikanten linearen Zusammenhang zwischen dem mittleren Versiegelungsgrad im 250m-Radius und der Abundanz (siehe Tab. \ref{summaryIH}).

Für beide Variablen Artenzahl und Abundanz kann mit dem Datensatz von 129 Punkten nur eine Tendenz eines positiven Einflusses von vorhandenen Insektenhäusern beobachtet werden, wobei dieser Einfluss auf die Artenzahl deutlicher zu sehen ist als auf die Abundanz. 


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.cap= "Einfluss von vorhandenem Insektenhaus auf Artenanzahl (links) und Abundanz (rechts) der Bienen. Die Fehlerbalken sind 'marginal effect-plots', welche die Vorhersage der Modelle (Mittelwert und Standartabweichung) bei variablem Versiegelungsgrad darstellen. Die Punkte sind die realen Datenpunkte. \\label{effektplotIH}" }
library(MASS)

sub_IH <- A1_IH_factor %>% 
  filter(!is.na(Insektenhaus)) %>% 
  mutate_at(vars(imp100:test3), scale) %>% 
  mutate(null_imp = mean(imp250))
## einfluss von Insektenhaus auf artenzahl:
modelIH <- glm.nb(Artenanzahl_det ~ Insektenhaus, data = sub_IH) ## signifikant

model_IH2a <- glm.nb(Artenanzahl_det ~ imp250 + I(imp250^2) + Insektenhaus, data = sub_IH) # signifikant

p1ep <- jtools::effect_plot(modelIH, pred = Insektenhaus, interval = TRUE, plot.points = TRUE,
                    jitter = .2) + 
  ylab("Artenzahl der Wirtsbienen")

## Abundanz:
model_IH5_zi <- readRDS("../Modelle/model_IH5_zi.rds")
model_IH2_250_zi <- readRDS("../Modelle/model_IH2_250_zi.rds")

# jtools::effect_plot(model_IH5_zi, pred = Insektenhaus, interval = TRUE, plot.points = TRUE,
#                     jitter = .2) +
#   ylab("Abundanz")

tranlabels <- function(x) attr(sub_IH$imp250, "scaled:center") + attr(sub_IH$imp250, "scaled:scale")*x
werte <- paste(round(tranlabels(c(-1, 0, 1)),2), collapse = ", ")

labeltext <- list("Die Werte des skalierten", 
                         "Versiegelunsgrades -1, 0, 1", 
                  "entsprechen den prozentualen", 
                         paste0("Werten von ", werte))

p2pm <- sjPlot::plot_model(model_IH2_250_zi, type = "pred", 
                   terms = c("Insektenhaus", "imp250"), 
                   show.p = T, show.data = T, jitter = T)+
  theme_bw() +
  annotate("text", y = seq(450,400,length=4), x = 0.35,
            label = labeltext)

gridExtra::grid.arrange(p1ep, p2pm, ncol = 2, heights = unit(4, c("in")))

```



```{r echo=FALSE}

detach("package:MASS")
# test <- sjPlot::tab_model(modelIH,  dv.labels = c("Artenzahl"), file = "modelIH.html", transform = NULL) 

tables <- rlist::list.clean(XML::readHTMLTable("../Modelle/modelIH.html"), fun = is.null, recursive = FALSE)
tables2 <- tables[[1]] %>% 
  janitor::row_to_names(row_number = 1) %>% 
  as.matrix() %>% as_tibble()

tables2[is.na(tables2)] <- ""

## Abundanz: 

# test <- sjPlot::tab_model(model_IH5_zi,  dv.labels = c("Artenzahl"), file = "../Modelle/model_IH5_zi.html", transform = NULL) 

tables5 <- rlist::list.clean(XML::readHTMLTable("../Modelle/model_IH5_zi.html"), fun = is.null, recursive = FALSE)
tables6 <- tables5[[1]] %>% 
  janitor::row_to_names(row_number = 1) %>% 
  as.matrix() %>% as_tibble() %>% 
  mutate(Predictors = janitor::make_clean_names(Predictors) )

#model_IH2a,
# test <- sjPlot::tab_model(model_IH2_250_zi,  dv.labels = c("Abundanz"), file = "../Modelle/model_IH2_250_zi.html", transform = NULL) 

tables7 <- rlist::list.clean(XML::readHTMLTable("../Modelle/model_IH2_250_zi.html"), fun = is.null, recursive = FALSE)
tables8 <- tables7[[1]] %>% 
  janitor::row_to_names(row_number = 1) %>% 
  as.matrix() %>% as_tibble() %>% 
  mutate(Predictors = janitor::make_clean_names(Predictors) )
  
table_2 <- tables8
table_2[is.na(table_2)] <- ""
table_2$Predictors <- c("count_model", "(Intercept)", "imp250", "imp250^2", "Insektenhaus [1]", "Intercept_2", "zero_inflated_model", "Intercept_3", "Observations")

##
# summary(model_IH5_zi)
# summary(model_IH2_250_zi) # laut anova: ist besser als model_IH5_zi 

```



```{r echo=FALSE, message=FALSE, warning=FALSE}
#htmltools::includeHTML("test.html")
table_a <- tables2 %>% 
  full_join(table_2, by = "Predictors", suffix = c(".","..")) %>% 
  filter(!Predictors %in% c("zero_inflated_model", "count_model"))
table_a[is.na(table_a)] <- ""
table_a[table_a$Predictors == "Intercept_2",1] <- "count_model: Intercept"
table_a[table_a$Predictors == "Intercept_3",1] <- "zero_inflated_model: Intercept"
table_a <- table_a[-c(3,4),]

kableExtra::kbl(table_a, booktabs =T, caption = "Modellzusammenfassung der Modelle zum Einfluss von vorhandenen Insektenhäusern auf Artenzahl und Abundanz. Die Modelle wurden jeweils unter der Annahme der Negativbinomialverteilung der Antwortvariablen an den reduzierten Datensatz (129 Beobachtungen) aller Nisthilfen mit Information zum vorhandensein eines Insektenhauses gefittet.  \\label{summaryIH} " ) %>% #caption = "" 
  kable_styling(latex_options =c("striped", "hold_position")) %>% 
  kableExtra::add_header_above(c(" ","Artenzahl"=3,"Abundanz"=3)) %>%
  kableExtra::kable_styling(latex_options =c("repeat_header", "scale_down")) %>% 
  kableExtra::column_spec(4,bold = (as.numeric(table_a$p.)<0.05 | table_a$p. == "<0.001")  & table_a$p. != "" )%>% 
  kableExtra::column_spec(7,bold = (as.numeric(table_a$p..)<0.05 | table_a$p.. == "<0.001") & table_a$p.. != "") 

```



## Der Einfluss des Versiegelungsgrades auf Artenzahl und Abundanz der Bienen
  

<!-- Anhand AIC und Residuendiagnostik wurden für beide Variablen, Artenzahl sowie Abundanz, negativ-binomiale GLM mit folgender Formel ausgewählt: $y = imp1000 + imp1000^2 + Insektenhaus$ (imp1000 ist der mittlere Versiegelungsgrad im 1000m Radius um den Nisthilfenstandort) -->
<!-- Die Datenpunkte sowie die Modellvorhersage als marginaler Effektplot sind in Abbildung \ref{effektplotIH} dargestellt. Das Modell der Artenzahl beschreibt einen signifikanten Einfluss des Parameters Insektenhaus (siehe Tab. \ref{summaryIH}). Im Modell der Abundanz ist eine Tendenz einer Zunahme der Abundanz bei Vorhandensein eines Insektenhauses zu erkennen, welche jedoch nicht signifikant ist. In beiden Modellen hat der Versiegelungsgrad im 1000m Umkreis keinen signifikanten Einfluss. -->
 

<!-- (Null_deviance - Residual_deviance)/Null_deviance -->
Der Versiegelungsgrad aller Radien eignet sich zur Beschreibung der Artenzahl der Wildbienen. Dies zeigte im Vergleich der Modelle  mit verschiedenen Radien des Versiegelungsgrades als beschreibende Variable, da sich die AIC-Werte der Modelle mit jeweils dem besten Fit, um weniger als zwei Einheiten unterschieden. 

Die Modelle mit dem besten Fit, welche den Versiegelungsgrad der Radien 100m, 250m und 500m beinhalten, beschreiben einen signifikanten linearen Zusammenhang ($p < 0.01$) des Versiegelungsgrades mit der Artenzahl. Mit zunehmendem Versiegelungsgrad nimmt die Artenzahl ab. Die Modelle mit dem besten Fit, welche den Versiegelungsgrad der Radien 1000m und 2000m beinhalten, beschreiben einen signifikanten quadratischen Zusammenhang des Versiegelungsgrades mit der Artenzahl. Bei einem Versiegelungsgrad von ca. $30 %$ ist die Artenzahl maximal (Abbildung \ref{plot_modelle_artenzahl} rechts). 
Alle ausgewählten Modelle beinhalten die weiteren Prädiktoren $Jahresniederschlag$ und $Jahresmitteltemperatur$. Der Jahresniederschlag zeigt jeweils einen schwach signifikaten negativen Einfluss auf die Artenzahl, die Jahresmitteltemperatur einen schwach signifikanten positiven Einfluss auf die Artenzahl.

Der Versiegelungsgrad der kleineren Radien von 100m, 250m und 500m beschreibt den Versiegelungsgrad im Bereich des Flugradius der Bienen, weshalb diese Parameter zur Beschreibung den Einfluss von direkt verfügbaren Ressourcen für die Bienen dienen. Der Versiegelungsgrad der größeren Radien von 1000m und 2000m stellt dagegen einen Indikator für den Grad der Urbanisierung und den Grad der Habitatvernetzung dar.


<!-- Zwischen der Artenzahl und dem Versiegelungsgrad besteht kein signifikanter Zusammenhang.   -->
<!-- Zwischen Abundanz und dem mittleren Versiegelungsgrad im 1000m-Radius besteht ein signifikanter quadratischer Zusammenhang. Für den mittleren Versiegelungsgrad geringerer Radien besteht kein Zusammenhang. -->

```{r Artenzahl, include=FALSE}
## selected models::

model1a_step <- readRDS("../Modelle/Artenzahl_100_step.rds")
model2a_step <- readRDS("../Modelle/Artenzahl_250_step.rds")
model3a_step <- readRDS("../Modelle/Artenzahl_500_step.rds")
model4a_step <- readRDS("../Modelle/Artenzahl_1000_step.rds")
model5a_step <- readRDS("../Modelle/Artenzahl_2000_step.rds")

# sjPlot::tab_model(model1a_step, model2a_step, model3a_step, model4a_step, model5a_step,
#                   dv.labels = c("imp100", "imp250", "imp500", "imp1000", "imp2000"),
#                   file = "../Modelle/model_Artenzahl.html", transform = NULL)
## transform html via excel to .csv-file
library(readr)
model_Artenzahl <- read_delim("../Modelle/model_Artenzahl.csv", 
    ";", escape_double = FALSE, col_names = FALSE, 
    trim_ws = TRUE) 
names(model_Artenzahl) <- model_Artenzahl[2,]
model_Artenzahl[is.na(model_Artenzahl)] <- ""
```



```{r echo=FALSE}

# function for detection of significant values:
p_sig <- function(x){
  x <- unlist(x, recursive = T)
  bold = suppressWarnings((as.numeric(x)<0.05 | x == "<0.001")  & 
                            x != "" &
                            !is.na(x))
  return(bold)
}

kableExtra::kbl(model_Artenzahl[-c(1,2,10),c(1:4,11:13)], booktabs =T, caption = "Modellzusammenfassung der ausgewählten Modelle der Artenzahl der Wildbiene, die den Versiegelungsgrades (imp) der Radien 100m und 1000m beinhalten. \\label{summary_Artenzahl} " ) %>% 
  kable_styling(latex_options =c("striped", "hold_position")) %>% 
  kableExtra::add_header_above(
    c(" ", "imp100"=3,"imp1000"=3)
  ) %>%
  kableExtra::kable_styling(latex_options =c("repeat_header", "scale_down")) %>% 
  # kableExtra::column_spec(c(4,7,10, 13,16),
  #                         bold = p_sig(.)) %>% 
  kableExtra::column_spec(4,bold = p_sig(model_Artenzahl[-c(1,2),4])) %>% 
  kableExtra::column_spec(7,bold = p_sig(model_Artenzahl[-c(1,2),13])) %>% 
  kableExtra::row_spec(7, hline_after = T)

```


```{r echo=FALSE, warning=FALSE, message=FALSE, fig.cap="Der Einfluss des Versiegelungsgrades im 100m-Radius (links) sowie im 1000m-Radius (rechts) auf die Artenzahl der Bienen. Die Punkte stellen die Werte der einzelnen Nisthilfen dar, die Kurve mit blau hinterlegtem Bereich die jeweilige Modellvorhersage mit Standartabweichung. \\label{plot_modelle_artenzahl}"}
unscale <- function(z, center = attr(z, "scaled:center"), scale = attr(z, "scaled:scale")) {
  if(!is.null(scale))  z <- sweep(z, 2, scale, `*`)
  if(!is.null(center)) z <- sweep(z, 2, center, `+`)
  structure(z,
    "scaled:center"   = NULL,
    "scaled:scale"    = NULL,
    "unscaled:center" = center,
    "unscaled:scale"  = scale
  )
}
# model0_step, model2a_step, model3a_step,model4c,model5c,

A1_100 <- A1 %>% 
  dplyr::select(-imp250, -imp500, -imp1000, -imp2000) %>% 
  #select(- Artenanzahl_det, - Abundanz) %>% 
  dplyr::select(-DistInsektenhaus, -Isnsektenhaus)%>% 
  rename(imp = imp100) %>% 
  mutate_at(vars(imp:test3), scale)%>% 
  dplyr::select(-Urban)

#imp + mean_annual_temp_celsius + annual_precipitation_mm + altitude_town_m
newdata <- A1_100 %>% tidyr::expand(imp, mean_annual_temp_celsius) %>% 
  left_join(A1_100[,c("annual_precipitation_mm", "mean_annual_temp_celsius", "altitude_town_m")])
pred_100 <- predict(model1a_step, newdata = newdata, type = "response", se.fit = T) 

pred_100 <- data.frame(pred = pred_100$fit, pred.se = pred_100$se.fit, 
                   imp = newdata$imp) %>% 
  group_by(imp) %>% 
  summarise(mean = mean(pred),
            min = min(pred),
            max = max(pred),
            quant95 = quantile(pred, 0.95),
            quant05 = quantile(pred, 0.05))
pred_100 <- pred_100 %>% 
  mutate(imp = unscale(pred_100[,"imp"], center = attr(A1_100$imp, "scaled:center"), scale = attr(A1_100$imp, "scaled:scale"))$imp)
#   ylab("Abundanz der Wirtsbienen") 

A1_1000 <- A1 %>% 
  dplyr::select(-imp100, -imp250, -imp500, -imp2000) %>% 
  #select(- Artenanzahl_det, - Abundanz) %>% 
  dplyr::select(-DistInsektenhaus, -Isnsektenhaus)%>% 
  rename(imp = imp1000) %>% 
  mutate_at(vars(imp:test3), scale) %>% 
  dplyr::select(-Urban, -len)
#
newdata <- A1_1000 %>% tidyr::expand(imp, mean_annual_temp_celsius) %>% 
  left_join(A1_1000[,c("annual_precipitation_mm", "mean_annual_temp_celsius", 'altitude_town_m', 'Pastures')])
pred_1000 <- predict(model4a_step, newdata = newdata, type = "response", se.fit = T) 

pred_1000 <- data.frame(pred = pred_1000$fit, pred.se = pred_1000$se.fit, 
                   imp = newdata$imp) %>% 
  group_by(imp) %>% 
  summarise(mean = mean(pred),
            min = mean(pred) - min(pred.se),
            max = mean(pred) + max(pred.se),
            quant95 = quantile(pred, 0.95),
            quant05 = quantile(pred, 0.05))
pred_1000 <- pred_1000 %>% 
  mutate(imp = unscale(pred_1000[,"imp"], center = attr(A1_1000$imp, "scaled:center"), scale = attr(A1_1000$imp, "scaled:scale"))$imp)

p1 <- ggplot(data = pred_100, aes(imp, mean)) +
  geom_line() +
  geom_ribbon(aes(ymin = quant05, ymax  =quant95), alpha = 0.2, fill = "blue") +
  geom_line(data = pred_100, aes(imp, mean), col = "darkblue") +
  geom_point(data = A1_100, aes(unscale(imp), Artenanzahl_det), alpha = 0.5)  +
  theme_bw() +
  ylab("Artenanzahl") +
  xlab("mittlerer Versiegelungsgrad [%] im 100m-Radius")

p2 <- ggplot(data = pred_1000, aes(imp, mean)) +
  geom_line() +
  geom_ribbon(aes(ymin = min, ymax  =max), alpha = 0.2, fill = "blue") +
  geom_line(data = pred_1000, aes(imp, mean), col = "darkblue") +
  geom_point(data = A1_1000, aes(unscale(imp), Artenanzahl_det), alpha = 0.5) +
  theme_bw()+
  ylab("Artenanzahl") +
  xlab("mittlerer Versiegelungsgrad [%] im 1000m-Radius")

gridExtra::grid.arrange(p1, p2, ncol = 2, heights = unit(4, c("in")))

```


Der mittlere Versiegelungsgrad der Radien 100m ($p= 0.003$), 250m ($p < 0.0001$)und 500m ($p= 0.016$) hat einen negativen linearen Einfluss auf die Abundanz (siehe Abbildung \ref{plot_modelle_abundanz} links). Einen signifikanten quadratischen Einfluss auf die Abunanz hat der mittlere Versiegelungsgrad der Radien 500m ($p= 0.013$), 1000m ($p= 0.011$) und 2000m ($p=0.005$). Bei einem Versiegelungsgrad von ca. $25 \%$ ist die Abundanz maximal (Abbildung \ref{plot_modelle_abundanz} rechts). 
Das Modell, welches den Versiegelungsgrad im 250m-Radius als Prädiktor enthält, zeigt einen negativen signifikanten Einfluss der Kantenlänge der Landnutzungsklassen auf die Abundanz, sowie einen schwach signifikanten positiven Einfluss der Anzahl an Landnutzungsklassen.


```{r Abundanz, echo=FALSE, message=FALSE, warning=FALSE}

model1b_zi <- readRDS("../Modelle/model1b_zi.rds")
model2a_step_zi <- readRDS("../Modelle/model2a_step_zi.rds")
model3b_zi <- readRDS("../Modelle/model3b_zi.rds")
model4b_zi <- readRDS("../Modelle/model4b_zi.rds")
model5b_zi <- readRDS("../Modelle/model5b_zi.rds")

model_abundanz <- read.csv("../Modelle/model_abundanz.csv") %>% 
  janitor::clean_names()

library(tidyr)
model_abundanz_a <- model_abundanz[,-c(11:16)] %>% 
  #dplyr::arrange(component) %>% 
  dplyr::relocate(component, .after = term) %>% 
   mutate(across(where(is.numeric), round, 3)) %>% 
  mutate_at(vars(contains('value')), 
            funs(case_when(. < 0.001~ "<0.001",
                           . >= 0.001 ~ as.character(.))
            )) %>% 
  replace(is.na(.), "")
names(model_abundanz_a) <- c("term" ,"component", "estimate", "std.error", "p.value", "estimate", "std.error", "p.value", "estimate", "std.error", "p.value" )

model_abundanz_b <- model_abundanz[,-c(2:10)] %>% 
  arrange(component)%>% 
  relocate(component, .after = term) %>% 
   mutate(across(where(is.numeric), round, 3)) %>% 
  mutate_at(vars(contains('value')), 
            funs(case_when(. < 0.001~ "<0.001",
                           . >= 0.001 ~ as.character(.))
            )) %>% 
  replace(is.na(.), "")
names(model_abundanz_b) <- c("term" ,"component", "estimate", "std.error", "p.value", "estimate", "std.error", "p.value")

kableExtra::kbl(model_abundanz_a, booktabs =T, caption = "Modellzusammenfassung der ausgewählten modelle der Abundanz für die Radien des Versiegelungsgrades 100m, 250m und 500m. Die Modelle wurden jeweils unter der Annahme der Negativbinomialverteilung der Antwortvariablen gefittet.  \\label{summary_Abundanz_a} " ) %>% 
  #kable_styling(latex_options =c("striped", "hold_position")) %>% 
  kableExtra::add_header_above(
    c(" " = 2, "imp100"=3,"imp250"=3,"imp500"=3)
  ) %>%
  kableExtra::kable_styling(latex_options =c("repeat_header", "scale_down", "striped", "hold_position")) %>% 
  # kableExtra::column_spec(c(4,7,10, 13,16),
  #                         bold = p_sig(.)) %>% 
  kableExtra::column_spec(5,bold = p_sig(model_abundanz_a[,5])) %>% 
  kableExtra::column_spec(8,bold = p_sig(model_abundanz_a[,8])) %>% 
  kableExtra::column_spec(11,bold = p_sig(model_abundanz_a[,11])) %>% 
  kableExtra::row_spec(5, hline_after = T)



```



```{r echo=FALSE, message=FALSE, warning=FALSE}

kableExtra::kbl(model_abundanz_b[-c(4,5,6),], booktabs =T, caption = "Modellzusammenfassung der ausgewählten modelle der Abundanz für die Radien des Versiegelungsgrades 1000m und 2000m. Die Modelle wurden jeweils unter der Annahme der Negativbinomialverteilung der Antwortvariablen gefittet.  \\label{summary_Abundanz_b} ", row.names = FALSE ) %>% 
  kableExtra::add_header_above(
    c(" " = 2, "imp1000"=3,"imp2000"=3)
  ) %>%
  kableExtra::kable_styling(latex_options =c("repeat_header", "striped", "hold_position")) %>% 
  # kableExtra::column_spec(c(4,7,10, 13,16),
  #                         bold = p_sig(.)) %>% 
  kableExtra::column_spec(5,bold = p_sig(model_abundanz_b[,5])) %>% 
  kableExtra::column_spec(8,bold = p_sig(model_abundanz_b[,8])) #%>% 
  #kableExtra::row_spec(3, hline_after = T)

```



```{r echo=FALSE, message=FALSE, warning=FALSE, fig.show='hold', out.width=c('45%', '45%'), fig.cap="Die Modelle des mittleren Versiegelungsgrades im 250m-Radius (links) sowie 2000m-Radius (rechts), welche den Einfluss der Nullen (Zeroinflation) brücksichtigen. Die Linie beschreibt den Mittelwert der mittels der R-Funktion simulate() simulierten Daten, der violett gezeichnete Bereich beschreibt Bereich bis zum 95 \\% Quantil der Simulierten Daten, die Punkte sind die realen Messwerte. \\label{plot_modelle_abundanz}"}

#


## prediction erzeugt merkwürdige werte...?
A1_100_sub <- A1_100 
pred_100 <- simulate(model1b_zi, nsim = 1000) # newdata = A1_100, type = "link", se.fit = T 
pred_100 <- data.frame(pred_mean = rowMeans(pred_100),
                       pred_max = matrixStats::rowQuantiles(as.matrix(pred_100), probs = 0.95),
                       pred_min = matrixStats::rowQuantiles(as.matrix(pred_100), probs = 0.05),
                       imp = unscale(A1_100_sub$imp))

A1_250 <- A1 %>% 
  dplyr::select(-imp100, -imp500, -imp1000, -imp2000) %>% 
  dplyr::select(-DistInsektenhaus, -Isnsektenhaus)%>% 
  rename(imp = imp250) %>% #filter(Abundanz < 500) %>% 
  mutate_at(vars(imp:test3), scale) %>% 
  dplyr::select(-Urban)

A1_250_sub <- A1_250 
pred_250 <- simulate(model2a_step_zi, nsim = 10000) # newdata = A1_100, type = "link", se.fit = T 
pred_250 <- data.frame(pred_mean = rowMeans(pred_250),
                       pred_max = matrixStats::rowQuantiles(as.matrix(pred_250), probs = 0.95),
                       pred_min = matrixStats::rowQuantiles(as.matrix(pred_250), probs = 0.05),
                       imp = unscale(A1_250_sub$imp))

###
g1 <- ggplot(data = pred_250) + 
  stat_smooth(aes(x = imp, y = pred_min, colour = "min"), method = "loess", se = FALSE, n = 259) +
  stat_smooth(aes(x = imp, y = pred_max, colour = "max"), method = "loess", se = FALSE, n = 259)

# build plot object for rendering 
gg1 <- ggplot_build(g1)

# extract data for the loess lines from the 'data' slot
df2 <- data.frame(imp = gg1$data[[1]]$x,
                  pred_min = gg1$data[[1]]$y,
                  pred_max = gg1$data[[2]]$y) 

###
ggplot(data = pred_250) +
  stat_smooth(aes(imp, pred_mean)) +
  geom_ribbon(data = df2, aes(x = imp, ymin = pred_min, ymax  =pred_max), alpha = 0.2, fill = "blue") +
  geom_point(data = A1_250_sub, aes(unscale(imp), Abundanz), alpha = 0.5) +
  theme_bw()+
  xlab("mittlerer Versiegelungsgrad [%] im 250m-Radius") +
  ylab("Abundanz (Anzahl der Brutzellen)")



#
A1_2000 <- A1 %>% 
  dplyr::select(-imp100, -imp250, -imp500, -imp1000) %>% 
  dplyr::select(-DistInsektenhaus, -Isnsektenhaus)%>% 
  rename(imp = imp2000)  %>%# filter(Abundanz < 500) %>% 
  mutate_at(vars(imp:test3), scale) %>% 
  dplyr::select(-Urban)
A1_2000_sub <- A1_2000

pred_2000 <- simulate(model5b_zi, nsim = 10000) # newdata = A1_100, type = "link", se.fit = T 
pred_2000 <- data.frame(pred_mean = rowMeans(pred_2000),
                       pred_max = matrixStats::rowQuantiles(as.matrix(pred_2000), probs = 0.95),
                       pred_min = matrixStats::rowQuantiles(as.matrix(pred_2000), probs = 0.05),
                       imp = unscale(A1_2000_sub$imp))


###
h1 <- ggplot(data = pred_2000) + 
  stat_smooth(aes(x = imp, y = pred_min, colour = "min"), method = "loess", se = FALSE, n = 259) +
  stat_smooth(aes(x = imp, y = pred_max, colour = "max"), method = "loess", se = FALSE, n = 259)

# build plot object for rendering 
hh1 <- ggplot_build(h1)

# extract data for the loess lines from the 'data' slot
df3 <- data.frame(imp = hh1$data[[1]]$x,
                  pred_min = hh1$data[[1]]$y,
                  pred_max = hh1$data[[2]]$y) 


ggplot(data = pred_2000) +
  stat_smooth( aes(imp, pred_mean), n = 259) +
  geom_ribbon(data = df3, aes(x = imp, ymin = pred_min, ymax  =pred_max), alpha = 0.2, fill = "blue") +
  geom_point(data = A1_2000_sub, aes(unscale(imp), Abundanz), alpha = 0.5) +
  theme_bw() +
  xlab("mittlerer Versiegelungsgrad [%] im 2000m-Radius") +
  ylab("Abundanz (anzahl Brutzellen)")

```



## Artenzahl der natürlichen Gegenspieler
Das Vorhandensein eines Insektenhauses im Umfeld des Nisthilfenstandortes hat einen positiven signifikanten Einfluss auf die Artenzahl der natürlichen Gegenspieler. Die Modellzusammenfassung des Modells mit dem Parameter zum Insektenhaus sowie mit der Erweiterung um die Parameter des Versiegelungsgrades im 250m-Radius ist in Tabelle \ref{summaryIH_par} dargestellt. Der Effektplot von zweiterem ist in Abbildung \ref{effektplotIH_par} abgebildet.
Das Modell mit der Information über vorhandene Insektenhäuser als unabhängiger Variable kann durch die Erweiterung um die Variablen des mittleren Versiegelungsgrades im 100m-Radius als linearer sowie quadratischer Term verbessert werden. Gleiches gilt für den mittleren Versiegelungsgrad im 250m- und 500m-Radius. Andersherum verbessert der Term des vorhandenen Insektenhauses die Modelle mit dem mittleren Versiegelungsgrad aller Radien.

```{r echo=FALSE, message=FALSE, warning=FALSE}
model_par <- rlist::list.clean(XML::readHTMLTable("../Modelle/model_par_IH_new.html"), fun = is.null, recursive = FALSE)[[1]]
parnames <-  model_par[1,]
model_par[is.na(model_par)] <- ""
#names(model_par) <- model_par[1,]
model_par1 <- model_par %>% 
  filter(V1 != "Predictors")
names(model_par1) <- parnames

kableExtra::kbl(model_par1,booktabs =T, caption = "Modellzusammenfassung des Modell welches den Einfluss von vorhandenen Insektenhäusern auf die Artenzahl der Gegenspieler beschreibt. Die Modelle wurden jeweils unter der Annahme der Negativbinomialverteilung der Antwortvariablen an den reduzierten Datensatz aller Nisthilfen mit Information zum vorhandensein eines Insektenhauses gefittet.  \\label{summaryIH_par} " ) %>% #caption = "" 
  #kableExtra::add_header_above(c(" ","Model 1"=3)) %>%
  kableExtra::kable_styling(latex_options =c("repeat_header", "striped", "hold_position")) %>% 
  kableExtra::column_spec(4,bold = (as.numeric(model_par1[,4])<0.05 | model_par1[,4] == "<0.001")  & model_par1[,4] != "" )
```



```{r echo=FALSE, fig.show='hold', message=FALSE, warning=FALSE, fig.cap= "Einfluss vom mittleren Versiegelungsgrad im 250m-Radius auf die Artenanzahl der Parasitoide. Mittelwert und Standartabweichung der Modellvorhersage sind durch die Kurven und den farbig hinterlegten Bereichen dargestellt. Der Effektplot des Modells zeigt eine Abnahme der Artenzahl der natürlichen Gegenspieler mit zunehmendem Versiegelungsgrad. Die Artenzahl ist dabei bei vorhandensein eines Insektenhauses in der Nähe des Nisthilfenstandortes (Insektenhaus = 1) höher als bei dem Fehlen eines Insektenhauses in der Nähe des Nisthilfenstandortes (Insektenhaus = 0). Die Punkte stellen die Artenzahlen der natürlichen Gegenspieler dar - für jede Nisthilfe einen Punkt. \\label{effektplotIH_par}" }
library(MASS)

sub_IH_scl <- A2 %>% 
  rename(Insektenhaus = Isnsektenhaus) %>% 
  filter(!is.na(Insektenhaus)) %>% 
  dplyr::mutate(Insektenhaus = as.factor(Insektenhaus)) %>% 
  mutate_at(vars(imp100:Forest), scale) %>% 
  mutate_at(vars(Host), scale) %>% 
  mutate_at(vars(test1:test3), scale)
  
sub_IH <- sub_IH_scl %>% 
  mutate_at(vars(imp100:Forest), as.numeric) %>% 
  mutate_at(vars(Host), as.numeric) %>% 
  mutate_at(vars(test1:test3), as.numeric)


## einfluss von Insektenhaus auf artenzahl:
model_IH2_250 <- MASS::glm.nb(Parasitoid ~ imp250 + I(imp250^2) + Insektenhaus + Host, data = sub_IH)


# jtools::effect_plot(model_IH2_250, pred = Insektenhaus, interval = TRUE, plot.points = TRUE,
#                     jitter = .2) + 
#   ylab("Artenzahl der Wirtsbienen")
tranlabels <- function(x = sub_IH$imp250) attr(sub_IH_scl$imp250, "scaled:center") + attr(sub_IH_scl$imp250, "scaled:scale")*x

ticks_x <- scale(c(0, 10, 20, 30, 40, 50, 60, 70, 80), 
      center =  attr(sub_IH_scl$imp250, "scaled:center"),
      scale = attr(sub_IH_scl$imp250, "scaled:scale"))

sjPlot::plot_model(model_IH2_250, type = "pred", 
                   terms = c( "imp250","Insektenhaus"),
                   show.p = T, show.data = T, jitter = T)+
  scale_x_continuous(breaks = ticks_x , 
                     labels = as.numeric(tranlabels(ticks_x))) +
  theme_bw()


```


```{r echo=FALSE, message=FALSE, warning=FALSE}
library(readr)
model_Artenzahl_par <- read_delim("../Modelle/model_Artenzahl_par.csv", 
    ";", escape_double = FALSE, col_names = FALSE, 
    trim_ws = TRUE) 
names(model_Artenzahl_par) <- model_Artenzahl_par[2,]
model_Artenzahl_par[is.na(model_Artenzahl_par)] <- ""


```

Zwischen der Artenzahl der Wirte und der natürlichen Gegenspieler besteht ein hochsignifikanter Zusammenhang ($p<2e-16$). Der Einfluss des Versiegelungsgrades auf die Abundanz kann in den Modellen des gesamten Datensatz ohne die Information zu vorhandenen Insektenhäusern nicht aufgezeigt werden. Die Modellannahmen der Modelle, welche den Einfluss des Versiegelungsgrades mit dem gesamten Datensatz beschreiben, sind durch die Devianz der Quantile verletzt. 



```{r echo=FALSE, message=FALSE, warning=FALSE, out.width=c('45%', '45%'), fig.show= 'hold', fig.cap="Die Modelle des Einflusses von mittlerem Versiegelungsgrades im 250m-Radius (links) sowie 2000m-Radius (rechts) auf die Artenzahl der natürlichen Gegenspieler. Die Linie beschreibt den Mittelwert der mit der R-Funktion simulate() für das jeweilige Modell simulierten Daten, der violett gezeichnete Bereich beschreibt Bereich bis zum 95 \\% Quantil der simulierten Daten, die Punkte sind die realen Messwerte \\label{plot_modelle_gegenspieler}", results='asis'}

library(dplyr)
model_par_2a_step <- readRDS("../Modelle/model_par_2a_step.rds")


A2_250 <- A2 %>% 
  dplyr::select(-imp100, -imp500, -imp1000, -imp2000) %>% 
  #select(- Parasitoid, - Abundanz) %>% 
  dplyr::select(-DistInsektenhaus, -Isnsektenhaus) %>% 
  rename(imp = imp250) %>% 
  mutate_at(vars(imp:Forest), scale) %>% 
  dplyr::select(-Urban)


pred_250b <- simulate(model_par_2a_step, nsim = 100000) # newdata = A1_100, type = "link", se.fit = T 
pred_250b <- data.frame(pred_mean = rowMeans(pred_250b),
                       pred_max = matrixStats::rowQuantiles(as.matrix(pred_250b), probs = 0.95),
                       pred_min = matrixStats::rowQuantiles(as.matrix(pred_250b), probs = 0.05),
                       imp = unscale(A2_250$imp))

ggplot(data = pred_250b, aes(imp, pred_mean)) +
  geom_line() +
  geom_ribbon(aes(ymin = pred_min, ymax  =pred_max), alpha = 0.2, fill = "blue") +
  geom_point(data = A2_250, aes(unscale(imp), Parasitoid), alpha = 0.5) +
  theme_bw()+
  xlab("mittlerer Versiegelungsgrad [%] im 250m-Radius") +
  ylab("Artenzahl der Gegenspieler")

## imp2000:
A2_2000 <- A2 %>% 
  dplyr::select(-imp100, -imp250, -imp500, -imp1000) %>% 
  #select(- Parasitoid, - Abundanz) %>% 
  dplyr::select(-DistInsektenhaus, -Isnsektenhaus) %>% 
  rename(imp = imp2000) %>% 
  mutate_at(vars(imp:Forest), scale)%>% 
  dplyr::select(-Urban)

model_par_5c <- readRDS("../Modelle/model_par_5c.rds")

pred_2000 <- simulate(model_par_5c, nsim = 10000) # newdata = A1_100, type = "link", se.fit = T 
pred_2000 <- data.frame(pred_mean = rowMeans(pred_2000),
                       pred_max = matrixStats::rowQuantiles(as.matrix(pred_2000), probs = 0.95),
                       pred_min = matrixStats::rowQuantiles(as.matrix(pred_2000), probs = 0.05),
                       imp = unscale(A2_2000$imp))

ggplot(data = pred_2000, aes(imp, pred_mean)) +
  geom_line() +
  geom_ribbon(aes(ymin = pred_min, ymax  =pred_max), alpha = 0.2, fill = "blue") +
  geom_point(data = A2_2000, aes(unscale(imp), Parasitoid), alpha = 0.5) +
  theme_bw()+
  xlab("mittlerer Versiegelungsgrad [%] im 2000m-Radius") +
  ylab("Artenzahl der Gegenspieler")
```

## Die Abundanz von Osmia bicornis
Die Rostrote Mauerbiene (*Osmia bicornis*) kam in 148 der 259 Nisthilfen vor.

Das Vorhandensein eines Insektenhauses in der Nähe der Nisthilfe hat keinen signifikanten Einfluss auf die Abundanz von *Osmia bicornis* (siehe Tabelle \ref{summary_Abundanz_IH_ob}). Der mittlere Versiegelungrad im 250m Radius um den Nisthilfenstandort verbessert das Modell welches den Einfluss des Insektenhauses auf die Abundanz von *O. bicornis* beschreibt. Der mittlere Versiegelungsgrad anderer Radien verbessert das Modell nicht. Der Parameter Insektenhaus kann keines der Modelle mit den Prädiktoren des Versiegelungsgrades der verschiedenen Radien verbessern.   


```{r echo=FALSE, message=FALSE, warning=FALSE}
model_IH_ob <- read_delim("../Modelle/model_IH_Ob_lat.csv", 
    ";", escape_double = FALSE, col_names = FALSE, 
    trim_ws = TRUE) 
names(model_IH_ob) <- model_IH_ob[2,]
model_IH_ob[is.na(model_IH_ob)] <- ""

kableExtra::kbl(model_IH_ob[-c(1,2),1:4], booktabs =T, caption = "Modellzusammenfassung des ausgewählten Modelles des Einflusses von vorhandenen Insektenhäusern auf die Abundanz von Osmia bicornis. Das Modell wurde unter der Annahme der Negativbinomialverteilung gefittet.  \\label{summary_Abundanz_IH_ob} " ) %>% 

  kableExtra::kable_styling(latex_options =c("repeat_header", "striped", "hold_position")) %>% 
  # kableExtra::column_spec(c(4,7,10, 13,16),
  #                         bold = p_sig(.)) %>% 
  kableExtra::column_spec(4,bold = p_sig(model_IH_ob[-c(1,2),4])) %>% 
  #kableExtra::column_spec(7,bold = p_sig(model_IH_ob[-c(1,2),7])) %>% 
  kableExtra::row_spec(5, hline_after = T)
```


```{r echo=FALSE, message=FALSE, warning=FALSE, results = 'asis'}
Ob_models_list <- readRDS(file = "../Modelle/Ob_models_list_new2.rds")

test <- sjPlot::tab_model(Ob_models_list[[1]], Ob_models_list[[2]], Ob_models_list[[3]],
                  Ob_models_list[[4]], Ob_models_list[[5]],
                  dv.labels = c("imp100", "imp250", "imp500", "imp1000", "imp2000"),
                  #file = "../../Modelle/model_Ob.html",
                  transform = NULL)


# test <- sjPlot::tab_model(Ob_models_list[[2]], Ob_models_list[[4]], Ob_models_list[[6]], 
#                   Ob_models_list[[8]], Ob_models_list[[10]],  
#                   dv.labels = c("imp100", "imp250", "imp500", "imp1000", "imp2000"),
#                   file = "Modelle/model_Ob2.html", transform = NULL) 


library(readr)
model_ob1 <- read_delim("../Modelle/model_Ob.csv", 
    ";", escape_double = FALSE, col_names = FALSE, 
    trim_ws = TRUE) 

names(model_ob1) <- model_ob1[2,]
model_ob1[is.na(model_ob1)] <- ""



# list(teil1 = model_ob1[,1:8], teil2 = model_ob1[,9:16]) %>% 
# #split(1:ncol(model_ob1), sort(rep_len(1:2, ncol(model_ob1)))) %>%
#   
#   #purrr::map(~dplyr::select(model_ob1, .)) %>%
#   purrr::map(kable, booktabs = T) %>%
#   purrr::map(kable_styling) %>%
#   purrr::walk(print)

kableExtra::kbl(model_ob1[-c(1,2),], booktabs =T, caption = "Modellzusammenfassung der ausgewählten Modelle von Osmia bicornis. Die Modelle wurden jeweils unter der Annahme der Negativbinomialverteilung gefittet.  \\label{summary_Abundanz_ob} " ) %>% 
  kableExtra::add_header_above(
    c(" ", "imp100"=3,"imp250"=3,"imp500"=3, "imp1000"=3, "imp2000"=3) 
  ) %>%
  kableExtra::kable_styling(latex_options =c("repeat_header", "scale_down", "striped", "hold_position")) %>% 
  # kableExtra::column_spec(c(4,7,10, 13,16),
  #                         bold = p_sig(.)) %>% 
  kableExtra::column_spec(4,bold = p_sig(model_ob1[-c(1,2),4])) %>% 
  kableExtra::column_spec(7,bold = p_sig(model_ob1[-c(1,2),7])) %>% 
  kableExtra::column_spec(10,bold = p_sig(model_ob1[-c(1,2),10])) %>% 
  kableExtra::column_spec(13,bold = p_sig(model_ob1[-c(1,2),13])) %>% 
  kableExtra::column_spec(16,bold = p_sig(model_ob1[-c(1,2),16])) %>% 
  kableExtra::row_spec(8, hline_after = T)

```


## Artengemeinschaft
Die Analyse der Artengemeinschaft entlang des Stadt-Land-Gradienten zeigte, dass weder Strukturparameter noch Versiegelungsgrad verschiedener Radien einen signifikanten Einfluss auf die Zusammensetzung der Arten in den Trapnestern hat. Auch der Vergleich der Artenzusammensetzung der Nisthilfen-Gruppen "Land" und "Stadt" zeigte keinen signifikanten Unterschied.

Die Artengemeinschaft von Standorten, bei denen im 500m-Radius Ackerland vorkommt unterscheidet sich nicht von der Artengemeinschaft, bei der im 500m-Radius kein Ackerland vorkomt.
<!-- -envfit Versiegelungsgrad und Strukturreichtum -->
<!-- - Adonis zwei Gruppen 50 versiegeltste STandorte und 50 unversiegelste Standorte (ländlich) -->


(ref:lonelytab) Auflistung der Arten, welche nur in einer Nisthilfe vorkommen, mit der Information wiviele Nester in der Nisthilfe belegt waren ('Nests') und dem mittleren Versiegelungsgrad in % im 500m-Radius der besiedelten Nisthilfe. \label{lonely_species} 


```{r echo=FALSE, message=FALSE, warning=FALSE}
# Arten die nur in einem Nest vorkamen:
lonely_species <- read.csv("../summaryTabellen/lonely_species_summary.csv") %>% 
  mutate(imp500 = round(imp500,2))

lonely_species %>%
  kable(booktabs = T, linesep = "",  caption = "(ref:lonelytab)") %>%
  kable_paper(full_width = F) %>%
  kableExtra::kable_styling(latex_options =c("repeat_header",  "hold_position")) %>% 
  column_spec(3, color = "white",
              background =spec_color(lonely_species$imp500, end = 0.50))



```


Es kamen elf Arten in nur einer Nisthilfe vor. Die Arten sind in Tabelle \ref{lonely_species} inklusive dem Versiegelungsgrad im 500m-Radius der Nisthilfe aufgeführt. Neun der elf Arten kamen in relativ gering versiegeltem Umfeld vor (Versiegelungsgrad im 500m-Radius < 25%). 
In Tabelle \ref{multiple_species} sind alle Arten aufgeführt, die in mehr als einer Nisthilfe vorkamen, sowie die Info in welcher Kategorie des Versiegelungsgrades die Nisthilfe vorkam. Dabei fällt auf, das die beiden Arten der parasitischen Gattung *Gasteruption* besonders häufig im Urbanen Gebiet mit hohem Versiegelungsgrad vorkamen. Die Gartenwollbiene, *Anthidium manicatum* kam in nur 2 Nisthilfen vor, davon keine aus der Kategorie "Land" mit geringem Versiegelungsgrad. Alle anderen Arten kamen auch in Nisthilfen der Kategorie "Land" vor. Dagegen kamen sieben Arten nicht in Nisthilfen der Kategorie "Stadt", mit hohem Versiegelungsgrad vor. Darunter die Gegenspieler *Chrysis radians*, *Sapyga clavicornis* und *Sapyga quinquepunctat*.



(ref:landspec) Auflistung der Arten, welche in mehr als einer Nisthilfe vorkamen. Die Nisthilfen wurden Anhand der 33% und 66%-Quantile des Versiegelungsgrades im 500m-Radius in die Kategorien 'Land' (<33%), 'Übergang' (>33% und <66%) und 'Stadt'(>66%)  unterteilt. In der Tabelle ist die Anzahl an besidelten Nisthilfen der jeweiligen Kategorie dargestellt. Der Anteil an besiedelten Nisthilfen in der Stadt ('Anteil_Stadt') beschreibt den Anteil von besiedelten Nisthilfen in der Stadt an der Summe von besiedelten Nisthilfen von Stadt und Land. Der Übergangsbereich wird nicht miteinberechnet. \label{multiple_species}


```{r echo=FALSE, message=FALSE, warning=FALSE}
# Arten nd wo sie vorkamen:
land_species <- read.csv("../summaryTabellen/Arten_Stad_Land.csv")
land_species <- land_species %>% arrange(Anteil_stadt)


rows <- seq_len(nrow(land_species) %/% 2)

# list(land_species[rows,],  
#            matrix(numeric(), nrow=0, ncol=1),
#            land_species[-rows, ])


land_species %>% 
  kable(booktabs = T, linesep = "", longtable =T, caption = "(ref:landspec)") %>% #
  kable_paper(full_width = F) %>%
  kableExtra::kable_styling(latex_options =c("repeat_header", "scale_down")) %>% 
  column_spec(5, color = "white",
              background =spec_color(land_species$Anteil_stadt, end = 1))



```


<!-- ## Thema -->

<!-- Detecting landscape patterns that impact the wild bee diversity and promote the potential occurance of different wild bee species. Landscape patterns like landuse type, imperviousness and water bodies may act as proxi-variables for the available nesting- and food-resources that directly affect the occurance of different wild bee species. -->

<!--  In the changing environment, wild bees adapt to new habitats. The knowledge about wild bees species hotspots, especially in urban areas, is important to design appropriate measures to promote diversity.  -->

## Netzwerkanalyse
Die Netzwerkanalyse der Kategorie "Land", welche 107 Nisthilfenstandorte beinhaltet und der Kategorie "Stadt" welche 110 Nisthilfenstandorte beinhaltest, ergibt für beide Kategorieen mit dem Index H2 einen mittleren Spezialisierungsgrad von 0.60 bzw. 0.61. Alle Werte der Generalisierung der natürlichen Gegenspieler als auch der Vulnerabilität der Wirtsbienenarten beider Gruppen liegen zwischen $2.0$ und $2.5$. Somit sind keine deutlichen Unterschiede der Wirt-Parasit-Beziehungen zwischen ländlichen Nisthilfenstandorten und urbanen Nisthilfenstandorten zu erkennen. In Abbildung \ref{networkland} ist das Interaktionsnetzwerk der Nisthilfen der Kategorie "Land" dargestellt, in Abbildung \ref{networkstadt} ist das Interaktionsnetzwerk der Nisthilfen der Kategorie "Stadt" dargestellt.

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Das Interaktionsnetzwerk der Nisthilfen der Kategorie Land. Die Kategorie beinhaltet alle Nisthilfen mit einem mittleren Versiegelungsgrad im 500m-Radius von weniger als 24\\% versiegelter Fläche. \\label{networkland}" }

Praedi_groups <- Praedis %>% 
  #filter(Praedis$ID %in% Artenzahl$location) %>% 
  mutate(
    group = ifelse(
      imp500 > quantile(Praedis$imp500, probs = 0.66),
      "stadt",
      ifelse(
        imp500 <= quantile(Praedis$imp500, probs = 0.33),
        "land",
        "medium"
      )
    )
  ) %>% 
  mutate(group = as.factor(group)) %>% 
  mutate(Ackerland = as.factor(case_when(Arable > 0  ~ "arable",
                                         Arable == 0 ~ "non_arable")))

library(bipartite) 

#table(Praedi_groups[,c("group")])
nw <- Artenzahl %>% 
  dplyr::select(id, location, species_type, Art) %>% 
  group_by(species_type, id) %>%
  mutate(row = row_number()) %>%
  tidyr::pivot_wider(names_from = species_type, values_from = Art) %>%
  dplyr::select(-row) %>% 
  left_join(dplyr::select(Praedi_groups, ID, group, Ackerland), by = c("location"= "ID")) %>% 
  filter(!is.na(Parasitoid)) %>% 
  filter(!is.na(Host))
  
nw_frame <-  frame2webs(nw, varnames = c("Host", "Parasitoid", "group"))

plotweb(nw_frame[[1]])


# visweb(nw_frame[[1]])
# visweb(nw_frame[[3]])

# round(networklevel(nw_frame[[1]], index = c("generality", "H2", "links per species", "nestedness", "connectance" )),2)
# round(networklevel(nw_frame[[3]], index = c("generality", "H2", "links per species", "nestedness", "connectance" )),2)
```



```{r echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Das Interaktionsnetzwerk der Nisthilfen der Kategorie Stadt. Die Kategorie beinhaltet alle Nisthilfen mit einem mittleren Versiegelungsgrad im 500m-Radius von mehr als 44\\% versiegelter Fläche. \\label{networkstadt}"}
plotweb(nw_frame[[3]])
```


<!-- invasive arten? -->

